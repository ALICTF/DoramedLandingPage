---
// src/components/KioskTimeline.astro
import { Image } from 'astro:assets';

import imgTrita from '../assets/1.png';
import imgRazi from '../assets/4.png';
import imgSimorgh from '../assets/3.png';
import imgSina from '../assets/2.png';

const versions = [
  {
    id: 1,
    version: "ูุฏู ุชุฑุชุง (V1.0)", 
    year: "ฑดฐฐ",
    title: "ูพุฑูุชูุชุงูพ ุงููู: ุขุบุงุฒ ฺฉ ุฑูุง",
    description: "ุงููู ฺฏุงู ูุง ุจุง ูุงู ยซุชุฑุชุงยปุ ูุฎุณุชู ูพุฒุดฺฉ ุงุณุงุทุฑ ุงุฑุงูุ ุขุบุงุฒ ุดุฏ. ุงู ูุณุฎู ุตุฑูุงู ฺฉ ุงุจุฒุงุฑ ุณูุฌุด ูุจูุฏุ ุจูฺฉู ุงุซุจุงุช ฺฉ ุงุฏู ุฌุณูุฑุงูู ุจูุฏ. ุจุง ุจุฏููโุง ููุฒ ู ูุณุชุญฺฉูุ ุชูุฑฺฉุฒ ุชู ูู ุจุฑ ุฑู ุทุฑุงุญ ูุฏุงุฑูุง ูพุงู ู ุงูุฏุงุฒูโฺฏุฑ ุฏููโุชุฑู ุดุงุฎุตโูุง ูุฒฺฉ ุนู ูุฏุ ูุฒู ู ูุญุงุณุจู BMI ูุฑุงุฑ ุฏุงุดุช.",
    image: imgTrita,
    alt: "ุชุตูุฑ ฺฉูุณฺฉ ุณูุงูุช ูุฏู ุชุฑุชุง ูุณุฎู ุงููู",
    features: ["ุณูุฌุด ูุฏ ู ูุฒู", "ุจุฏูู ููุฒ ุตูุนุช", "ูุญุงุณุจูโฺฏุฑ BMI " , "ูพุงุด ููุงุฑ ููุจ"]
  },
  {
    id: 2,
    version: "ูุฏู ุฑุงุฒ (V2.0)", 
    year: "ฑดฐฑ",
    title: "ูุณุฎู ุชุฌุงุฑ: ุฏูุช ู ูุดุงูุฏู",
    description: "ุจุง ุงููุงู ุงุฒ ุฒฺฉุฑุง ุฑุงุฒุ ูุณุฎู ุฏูู ูุชููุฏ ุดุฏ. ุฏุฑ ุงู ูุฑุญููุ ูุง ุงุฒ ูุงุฒ ุขุฒูุงุดฺฏุงู ุฎุงุฑุฌ ุดุฏู ู ูุญุตูู ุชุฌุงุฑ ุจุง ุทุฑุงุญ ุงุฑฺฏููููฺฉ ุงุฑุงุฆู ุฏุงุฏู. ุฌูุด ุจุฒุฑฺฏ ูุงุ ุงูุฒูุฏู ูุงฺููโูุง ุฏูู ูุดุงุฑ ุฎูู ู ูพุฑูุชุฑ ุญุฑุงุฑุช ุจูุฏ ุชุง ฺฉุงุฑุจุฑุงู ูุชุฌู ุฑุง ููุงู ูุญุธู ูฺฉุชูุจ ุฏุฑุงูุช ฺฉููุฏ.",
    image: imgRazi,
    alt: "ุชุตูุฑ ฺฉูุณฺฉ ุณูุงูุช ูุฏู ุฑุงุฒ ุจุง ูพุฑูุชุฑ ุญุฑุงุฑุช",
    features: ["ูุงฺูู ูุดุงุฑ ุฎูู ุฏุฌุชุงู", "ูพุฑูุชุฑ ุญุฑุงุฑุช ุขู", "ุจุฏูู ฺฉุงููพูุฒุช ุงุฑฺฏููููฺฉ"]
  },
  {
    id: 3,
    version: "ูุฏู ุณูุฑุบ (V3.0)", 
    year: "ฑดฐฒ",
    title: "ูพุฑูุงุฒ ุฏุงุฏูโูุง ุจู ุงุจุฑูุง",
    description: "ู ุขูฺฏุงู ยซุณูุฑุบยป ูพุฑ ฺฏุดูุฏ. ุฏุฑ ุงู ูุณุฎู ุจุง ุชุบุฑ ุณุงุฎุชุงุฑ ุจู ุทุฑุงุญ ุฏูุงุฑ ู ูููุงูุ ูุถุง ฺฉูุชุฑ ุงุดุบุงู ุดุฏ ู ุจุง ุงุชุตุงู ุจู ูุถุง ุงุจุฑ (Cloud)ุ ูุฑุฒูุง ูุฒฺฉ ุดฺฉุณุช. ฺฉุงุฑุจุฑุงู ูโุชูุงูุณุชูุฏ ุจุง ุดูุงุฑู ููุจุงู ูุงฺฏู ฺฉููุฏ ู ูพุฑููุฏู ุณูุงูุช ุฏุฌุชุงู ุชุดฺฉู ุฏููุฏ.",
    image: imgSimorgh,
    alt: "ุชุตูุฑ ฺฉูุณฺฉ ุณูุงูุช ุฏูุงุฑ ูุฏู ุณูุฑุบ",
    features: ["ุทุฑุงุญ ุฏูุงุฑ (Wall-mount)", "ูพุฑููุฏู ุณูุงูุช ุงุจุฑ", "ุงุญุฑุงุฒ ููุช ุจุง ููุจุงู"]
  },
  {
    id: 4,
    version: "ูุฏู ุณูุง (V4.0)", 
    year: "ฑดฐณ - ุงฺฉููู",
    title: "ุงูุฌ ููุดููุฏ ุจุง AI",
    description: "ุงูุฌ ุชฺฉุงูู ูููุฏุณ ุฏุฑ ูุฏู ยซุณูุงยป. ุงู ุฏุณุชฺฏุงู ููุท ุฏุงุฏู ุฌูุน ููโฺฉูุฏุ ุจูฺฉู ยซูฺฉุฑยป ูโฺฉูุฏ. ุจุง ุงูุฒูุฏู ุณูุณูุฑูุง SpO2 ู ุชุจโุณูุฌ ู ุงุฏุบุงู ููุด ูุตููุนุ ุงูฺฏููุง ุฎุทุฑ ุฑุง ุดูุงุณุง ูโฺฉูุฏ. ุณุณุชู ุชุดุฎุต ฺูุฑู ูุฒ ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุฑุง ุจู ุณุทุญ ุฌุฏุฏ ุจุฑุฏู ุงุณุช.",
    image: imgSina,
    alt: "ุชุตูุฑ ฺฉูุณฺฉ ููุดููุฏ ูุฏู ุณูุง ุจุง ูุงุจูุช ุชุดุฎุต ฺูุฑู",
    features: ["ุชุญููฺฏุฑ ููุด ูุตููุน", "ุชุดุฎุต ฺูุฑู ", "ูพุงุด ฺฉุงูู ุนูุงุฆู ุญุงุช"]
  }
];
---

<section id="kiosk-evolution" class="bg-gradient-to-b from-white via-white to-doramed-white/100 relative overflow-hidden py-16 md:py-24">
    
    <div class="container mx-auto px-4 md:px-8 lg:px-6 relative z-10">
        
        <div class="text-center max-w-4xl mx-auto mb-16 md:mb-24">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-doramed-primary/10 text-doramed-primary text-xs font-bold mb-4 border border-doramed-primary/20">
                ุชฺฉููููฺ ุจููุ ุงุณุชุงูุฏุงุฑุฏ ุฌูุงู
            </div>
            <h2 class="text-3xl md:text-4xl lg:text-5xl font-extrabold text-doramed-darker mb-6 leading-tight">
                ูุฑุงุซ ุณูุงูุช: ุงุฒ <span class="text-doramed-primary">ุชุฑุชุง</span> ุชุง <span class="text-doramed-primary">ุณูุง</span>
            </h2>
            
            <p class="text-doramed-muted text-base md:text-lg leading-relaxed mb-6 text-justify md:text-center px-2 md:px-0">
                ุจุง ฺฉูุณฺฉ ูพุงุด ุณูุงูุช ุฏูุฑุงูุฏุ ฺฉ ฺฉููฺฉ ููุดููุฏ ูุฌูุฒ ุจู <span class="text-doramed-primary font-bold">ููุด ูุตููุน</span> ุฑุง ุจู ูุถุง ุฎูุฏ ุจุงูุฑุฏ. ุงู ุงุณุชฺฏุงู ูพุดุฑูุชูุ ูุฑุงุชุฑ ุงุฒ ูพุงุด ูุญุธูโุง ุนูุงุฆู ุญุงุชุ ุจุง ุงูฺฏูุฑุชูโูุง ุฏููุ ุฏุงุฏูโูุง ุดูุง ุฑุง ุชุญูู ฺฉุฑุฏู ู ุงูฺฏููุง ูพููุงู ุณูุงูุช ุฑุง ุดูุงุณุง ูโฺฉูุฏ.
            </p>

            <div class="relative inline-block mt-4">
                <p class="text-doramed-primary font-bold text-lg md:text-xl relative z-10">
                    ูุณุฑ ฺฉู ุท ฺฉุฑุฏู ุชุง ูพุดุฑูุชูโุชุฑู ุงุณุชฺฏุงู ุณูุงูุช ฺฉุดูุฑ ุฑุง ุจุณุงุฒู.
                </p>
            </div>
        </div>

        <div class="relative wrap overflow-hidden p-0 h-full">
            
            <div class="border-2-2 absolute border-opacity-20 border-doramed-primary h-full border left-4 md:left-8 lg:left-1/2 top-0 transform -translate-x-1/2 transition-all duration-500" style="border-width: 2px;"></div>

            {versions.map((item, index) => (
                <article class={`mb-16 md:mb-24 flex justify-between items-stretch w-full timeline-item opacity-0 translate-y-20 transition-all duration-1000 ease-out flex-col lg:flex-row ${index % 2 === 0 ? 'lg:flex-row-reverse left-timeline' : 'right-timeline'}`}>
                    
                    <div class="order-1 w-full lg:w-5/12 px-6 py-4 hidden lg:flex flex-col">                    
                        <div class="flex flex-col h-full min-h-[550px] text-right bg-white p-8 rounded-3xl shadow-sm border border-doramed-white hover:shadow-lg hover:border-doramed-primary/30 transition-all duration-300">
                            <span class="mb-3 font-bold text-doramed-primary text-sm block tracking-widest uppercase">{item.year}</span>
                            <h3 class="mb-4 font-extrabold text-doramed-darker text-3xl">{item.title}</h3>
                            <h4 class="mb-6 text-lg text-doramed-primary font-bold border-b border-doramed-white pb-2 inline-block w-max">{item.version}</h4>
                            
                            <p class="text-base leading-8 text-doramed-muted mb-8 text-justify flex-grow">
                                {item.description}
                            </p>
                            
                            <div class="flex flex-wrap gap-2 mt-auto">
                                {item.features.map(f => (
                                    <span class="text-xs font-bold bg-doramed-white text-doramed-darker px-3 py-1.5 rounded-lg border border-doramed-gray/20">
                                        {f}
                                    </span>
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    <div class="z-20 flex items-center order-1 bg-doramed-primary shadow-xl w-10 h-10 md:w-14 md:h-14 rounded-full border-4 border-white absolute left-4 md:left-8 lg:left-1/2 transform -translate-x-1/2 mt-8 lg:mt-0 transition-all duration-500">
                        <h1 class="mx-auto font-bold text-xs md:text-sm text-white">{index + 1}</h1>
                    </div>
                    
                    <div class="order-1 w-full lg:w-5/12 pl-12 md:pl-20 lg:pl-0 lg:px-6 flex flex-col items-end">
                        <div class="w-full items-end bg-white p-5 md:p-8 rounded-3xl lg:rounded-[2.5rem] shadow-xl border border-doramed-white hover:border-doramed-primary/50 transition group relative overflow-hidden h-full min-h-auto lg:min-h-[550px] flex flex-col justify-center">                            
                            <div class="absolute top-0 right-0 w-32 h-32 md:w-40 md:h-40 bg-doramed-primary/5 rounded-full blur-3xl opacity-50 -mr-10 -mt-10 group-hover:bg-doramed-primary/10 transition"></div>
                            
                            <div class="relative w-full flex-grow flex items-center justify-center p-2 md:p-6">
                                <Image 
                                    src={item.image} 
                                    alt={item.alt}
                                    width={500}
                                    format="webp"
                                    class="w-full h-auto max-h-[300px] md:max-h-[450px] object-contain transform group-hover:scale-105 transition duration-700 drop-shadow-lg" 
                                />
                            </div>

                            <div class="block lg:hidden mt-6 px-1 pb-2 w-full text-right">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-doramed-primary text-xs md:text-sm font-bold bg-doramed-primary/10 px-2 py-1 rounded-md">{item.year}</span>
                                    <h4 class="text-sm md:text-base font-bold text-doramed-primary">{item.version}</h4>
                                </div>
                                
                                <h3 class="text-lg md:text-2xl font-bold text-doramed-darker mb-3">{item.title}</h3>
                                
                                <p class="text-sm md:text-base text-doramed-muted mb-6 leading-7 text-justify">
                                    {item.description}
                                </p>
                                
                                <div class="flex flex-wrap gap-2">
                                    {item.features.map(f => (
                                        <span class="text-[10px] md:text-xs bg-gray-50 text-gray-700 px-2 py-1 md:px-3 md:py-1.5 rounded-lg border border-gray-200 font-medium">{f}</span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                </article>
            ))}

            <div class="mb-16 flex flex-col items-center w-full timeline-item opacity-0 translate-y-20 transition-all duration-1000 ease-out pl-8 md:pl-16 lg:pl-0">
                <div class="z-20 flex items-center justify-center bg-doramed-darker shadow-xl w-10 h-10 md:w-16 md:h-16 rounded-full border-4 border-white animate-bounce mb-6 relative right-[125px] md:right-[150px] lg:right-auto lg:left-0 top-16 lg:top-auto">
                    <h1 class="font-bold text-lg md:text-2xl text-white">?</h1>
                </div>
                
                <div class="bg-gradient-to-br from-doramed-darker to-doramed-dark rounded-2xl md:rounded-[2.5rem] shadow-2xl w-full lg:w-3/4 px-5 py-8 md:px-12 md:py-12 border-2 border-doramed-muted relative overflow-hidden group text-center mt-6 lg:mt-0">
                    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 mix-blend-overlay hidden md:block pointer-events-none"></div>
                    
                    <span class="mb-2 md:mb-3 font-bold text-doramed-primary text-xs md:text-sm block tracking-widest uppercase">V5.0 - ุขูุฏู ูุฒุฏฺฉ</span>
                    <h3 class="mb-3 md:mb-4 font-black text-white text-xl md:text-3xl leading-tight">ูฺฺฏ ุจุนุฏ ุจุง ุดูุง!</h3>
                    
                    <p class="text-doramed-gray text-sm md:text-lg leading-relaxed mb-6 md:mb-8 max-w-xl mx-auto">
                        ูุง ุฏุฑ ุญุงู ุชูุณุนู ูุณู ูพูุฌู ฺฉูุณฺฉ ูุณุชู. ุจู ูุธุฑ ุดูุง ุฌุง ฺู ูุงุจูุช ุฏุฑ ุงู ุฏุณุชฺฏุงู ุฎุงู ุงุณุชุ
                    </p>

                    <div class="flex justify-center">
                        <button id="open-suggestion-modal" class="relative w-full md:w-auto px-6 py-3.5 md:px-8 md:py-4 bg-white text-doramed-darker font-extrabold rounded-xl shadow-lg hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2 text-sm md:text-base cursor-pointer">
                            <span class="relative z-10">ุซุจุช ูพุดููุงุฏ</span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4 md:w-5 md:h-5 relative z-10">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<div id="suggestion-modal" class="fixed inset-0 z-[9999] hidden flex items-center justify-center px-4" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-doramed-darker/80 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>
    <div class="relative bg-white rounded-3xl w-full max-w-md p-6 md:p-8 shadow-2xl transform scale-90 opacity-0 transition-all duration-300 border border-doramed-white" id="modal-content">
        <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 transition-colors p-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <div class="text-center mb-6">
            <div class="w-16 h-16 bg-doramed-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 text-doramed-primary animate-pulse">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.001 6.001 0 00-5.951 5.808 6 6 0 00-3.001 3.003h17.904a6 6 0 00-3.001-3.003A6.001 6.001 0 0012 12.75zm0 0a6 6 0 016-6v-3.75h-3a6 6 0 01-6 6v3.75h-3a6 6 0 01-6 6v3.75h-3a6 6 0 01-6 6v3.75h-3a6 6 0 01-6 6v3.75h-3a6 6 0 00-6 6v3.75h-3a6 6 0 006-6z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
            </div>
            <h3 class="text-2xl font-extrabold text-doramed-darker">ุงุฏู ุดูุงุ ุขูุฏู ูุง</h3>
            <p class="text-sm text-doramed-muted mt-2">ฺู ูฺฺฏ ุฌุฏุฏ ุฏุฑ ฺฉูุณฺฉ ุณูุงูุช ูุงุฒ ุฏุงุฑุฏุ</p>
        </div>
        <form class="space-y-4" id="suggestion-form">
            <div><label class="block text-sm font-bold text-doramed-dark mb-1">ูุงู ุดูุง (ุงุฎุชุงุฑ)</label><input type="text" class="w-full px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-doramed-primary focus:ring-0 outline-none transition bg-gray-50 focus:bg-white" /></div>
            <div><label class="block text-sm font-bold text-doramed-dark mb-1">ูพุดููุงุฏ ุดูุง *</label><textarea required rows="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-doramed-primary focus:ring-0 outline-none transition bg-gray-50 focus:bg-white resize-none"></textarea></div>
            <button type="submit" class="w-full py-4 bg-doramed-primary text-white font-bold rounded-xl hover:bg-doramed-darker transition shadow-lg hover:shadow-xl transform active:scale-95">ุงุฑุณุงู ุงุฏู ๐</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('astro:page-load', () => {
        // Observer for animations
        const observerOptions = { root: null, threshold: 0.1 };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.remove('opacity-0', 'translate-y-20');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);
        document.querySelectorAll('.timeline-item').forEach(item => observer.observe(item));

        // Modal Logic
        const modal = document.getElementById('suggestion-modal');
        const modalContent = document.getElementById('modal-content');
        const backdrop = document.getElementById('modal-backdrop');
        const openBtn = document.getElementById('open-suggestion-modal');
        const closeBtn = document.getElementById('close-modal');
        const form = document.getElementById('suggestion-form');

        const toggleModal = (show) => {
            if (!modal || !modalContent || !backdrop) return;
            if (show) {
                modal.classList.remove('hidden');
                requestAnimationFrame(() => {
                    backdrop.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-90', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                });
            } else {
                backdrop.classList.add('opacity-0');
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-90', 'opacity-0');
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            }
        };

        if(openBtn) openBtn.addEventListener('click', () => toggleModal(true));
        if(closeBtn) closeBtn.addEventListener('click', () => toggleModal(false));
        if(backdrop) backdrop.addEventListener('click', () => toggleModal(false));
        
        if(form) {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('ููููู! ูพุดููุงุฏ ุดูุง ุซุจุช ุดุฏ.');
                toggleModal(false);
                e.target.reset();
            });
        }
    });
</script>